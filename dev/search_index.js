var documenterSearchIndex = {"docs":
[{"location":"#TIFFDatasets","page":"Home","title":"TIFFDatasets","text":"Documentation for TIFFDatasets.jl, a Julia package for loading geoTIFF files using ArchGDAL.\n\nTIFFDatasets.jl implements for the TIFF format the interface defined in CommonDataModel.jl. The functions defined by CommonDataModel.jl are also available for TIFF data, including:\n\nvirtually concatenating multiple files along a given dimension\ncreate a virtual subset (view) by indices or by values of coordinate variables (CommonDataModel.select, CommonDataModel.@select)\ngroup, map and reduce (with mean, standard deviation std, ...) a variable (CommonDataModel.groupby, CommonDataModel.@groupby) and rolling reductions like running means CommonDataModel.rolling).\n\nHowever, TIFFDatasets cannot modify or create geoTIFF files.","category":"section"},{"location":"#Installation","page":"Home","title":"Installation","text":"Inside the Julia shell, you can download and install TIFFDatasets using the following commands:\n\nusing Pkg\nPkg.add(\"TIFFDatasets\")\n\nOr by typing ]add TIFFDatasets using the package manager REPL-mode.","category":"section"},{"location":"#API-reference","page":"Home","title":"API reference","text":"","category":"section"},{"location":"#TIFFDatasets.TIFFDataset","page":"Home","title":"TIFFDatasets.TIFFDataset","text":"ds = TIFFDataset(fname::AbstractString,mode = \"r\"; varname = \"band\",\n                 projection = \"EPSG:4326\",\n                 catbands = false,\n                 dimnames = (\"cols\",\"rows\",\"bands\"))\n\nCreate a data set structure from the GeoTIFF file name fname using ArchGDAL. The data variable will be called varname (followed by the band number). The dataset ds will also have the virtual variables x, y and lon, lat representing the projected coordinates (as defined in the GeoTIFF file) and the corresponding longitude/latitude (using the projection as defined by the projection parameter). The names of the dimensions can be adapted using the parameter dimnames. The type of projection can be checked with the attributes (grid_mapping_name, longitude_of_central_meridian, false_easting, false_northing, latitude_of_projection_origin, scale_factor_at_central_meridian, longitude_of_prime_meridian, semi_major_axis, inverse_flattening, ... depending on the projection used) of the virtual variable crs. The attribute crs_wkt describes the coordinate reference system as so-called \"Well-Known Text\"\n\nIn addition to the CF conventions, there is also the attribute GeoTransform [1] with six numbers describing a linear mapping between indices and the projected coordinates. For the point (i,j) the projected coordinates are computed as:\n\nshift = 0.5 # center\nx_geo = GeoTransform[1] + (i-shift) * GeoTransform[2] + (j-shift) * GeoTransform[3]\ny_geo = GeoTransform[4] + (i-shift) * GeoTransform[5] + (j-shift) * GeoTransform[6]\n\nSetting catbands to true, will concatenate all bands into a single variable called varname. If catbands is true, it is the user's responsibility to check that all bands have the same no-data value, offset and scale factor. Check with the command line tool gdalinfo filename or use ArchGDAL to inspect the file. If this is not the case, catbands = true should not be used.\n\nExample:\n\nusing TIFFDatasets\nfname = download(\"https://data-assimilation.net/upload/Alex/TIFF/S2_1-12-19_48MYU_0.tif\")\nds = TIFFDataset(fname)\nband1 = ds[\"band1\"][:,:];\nlongitude = ds[\"lon\"][:,:];\nlatitude = ds[\"lat\"][:,:];\n# x,y native projection\nx = ds[\"x\"][:,:];\ny = ds[\"y\"][:,:];\n# coordinate reference system as \"Well-Known Text\"\ncrs_wkt = ds[\"crs\"].attrib[\"crs_wkt\"];\n\nFor performance reasons, one should avoid loading a large number of individual elements (or using function that do so, like sum, mean ...) and rather load the whole array. For example:\n\njulia> @time sum(ds[\"band1\"]) # slow\n  0.062227 seconds (721.65 k allocations: 22.045 MiB)\n6403.1743f0\n\njulia> @time sum(ds[\"band1\"][:,:]) # much faster\n  0.000381 seconds (765 allocations: 302.781 KiB)\n6403.5527f0\n\nThe dataset can be manipulated using the functions from CommonDataModel.jl. Writing to a file is currently not supported (pull-requests are welcome!).\n\nReference:\n\n[1] GDAL GeoTransform\n\n\n\n\n\n","category":"type"},{"location":"#TIFFDatasets.TIFFDataset-Tuple{AbstractVector{<:AbstractString}, Vararg{Any}}","page":"Home","title":"TIFFDatasets.TIFFDataset","text":"TIFFDataset(fnames::AbstractVector{<:AbstractString};\n            aggdim=name, isnewdim=false)\n\nConcatenate TIFF files fnames along the dimension specified with aggdim. The parameter isnewdim must be true for new dimensions not initially present in the file. See CommonDataModel.MFDataset for more information of the arguments.\n\n\n\n\n\n","category":"method"},{"location":"examples/flood_example/#MODIS/AquaTerra-Global-Flood-Product","page":"MODIS/Aqua+Terra Global Flood Product","title":"MODIS/Aqua+Terra Global Flood Product","text":"In this example, we will download and visualize the MODIS/Aqua+Terra Global Flood Product for the Valencia region (Spain) on the 2d November, 2024.\n\nThe data has been also be downloaded from NASA World View. Unfortunately, only the last 7 days are visible on this sites but the download links below are still available. On the NASA World View page, one can click on \"Add Layers\", cloose \"Flood (3-Day Window)\" and confirm with \"Add Layer\". To download the data for a different day, click on \"Data\" and download the \"MODIS/Aqua+Terra Global Flood Product L3 NRT 250m 3-day GeoTIFF\" product, set your area of interest and go to \"Download Via EarthData Search\".\n\nusing Dates\nusing TIFFDatasets\nusing CairoMakie\nusing CommonDataModel: @select\nusing ColorSchemes\nusing Statistics\n\nstore images as separated files\n\nCairoMakie.enable_only_mime!(\"png\")\n\nThe data was originally available at nrt3.modaps.eosdis.nasa.gov:\n\nurls = [\n    \"https://data-assimilation.net/upload/Alex/TIFF/MCDWD_L3_F2_NRT.A2024306.h17v05.061.tif\",\n    \"https://data-assimilation.net/upload/Alex/TIFF/MCDWD_L3_F2_NRT.A2024306.h18v05.061.tif\",\n];\n\nDownload the data if necessary\n\nfnames = basename.(urls)\n\nif !all(isfile.(fnames))\n    download.(urls,fnames)\nend\n\n2-element Vector{String}:\n \"MCDWD_L3_F2_NRT.A2024306.h17v05.061.tif\"\n \"MCDWD_L3_F2_NRT.A2024306.h18v05.061.tif\"\n\nInspect the first geoTIFF file\n\nds = TIFFDataset(fnames[1],\"r\")\n\nDataset: MCDWD_L3_F2_NRT.A2024306.h17v05.061.tif\nGroup: /\n\nDimensions\n   cols = 4800\n   rows = 4800\n\nVariables\n  lon   (4800 × 4800)\n    Datatype:    Float64 (Float64)\n    Dimensions:  cols × rows\n    Attributes:\n     standard_name        = longitude\n     units                = degrees_east\n\n  lat   (4800 × 4800)\n    Datatype:    Float64 (Float64)\n    Dimensions:  cols × rows\n    Attributes:\n     standard_name        = latitude\n     units                = degrees_north\n\n  x   (4800)\n    Datatype:    Float64 (Float64)\n    Dimensions:  cols\n    Attributes:\n     standard_name        = projection_x_coordinate\n\n  y   (4800)\n    Datatype:    Float64 (Float64)\n    Dimensions:  rows\n    Attributes:\n     standard_name        = projection_y_coordinate\n\n  crs  \n    Attributes:\n     longitude_of_prime_meridian = 0.0\n     semi_major_axis      = 6.3782064e6\n     inverse_flattening   = 294.978698213898\n     crs_wkt              = GEOGCS[\"Unknown datum based upon the Clarke 1866 ellipsoid\",DATUM[\"Not specified (based on Clarke 1866 spheroid)\",SPHEROID[\"Clarke 1866\",6378206.4,294.978698213898,AUTHORITY[\"EPSG\",\"7008\"]]],PRIMEM[\"Greenwich\",0],UNIT[\"degree\",0.0174532925199433,AUTHORITY[\"EPSG\",\"9122\"]],AXIS[\"Latitude\",NORTH],AXIS[\"Longitude\",EAST]]\n     GeoTransform         = -10.0 0.0020833333333333333 0.0 40.0 0.0 -0.0020833333333333333\n\n  band1   (4800 × 4800)\n    Datatype:    Union{Missing, UInt8} (UInt8)\n    Dimensions:  cols × rows\n    Attributes:\n     grid_mapping         = crs\n     _FillValue           = 255.0\n     long_name            = NRT Combined Terra and Aqua MODIS Flood_2Day_250m\n     valid_range          = UInt8[0x00, 0x03]\n\nGlobal attributes\n  Conventions          = CF-1.8\n  ALGORITHMPACKAGEACCEPTANCEDATE = 2019-10-09\n  ALGORITHMPACKAGEMATURITYCODE = verified\n  ALGORITHMPACKAGENAME = MCDFLOOD\n  ALGORITHMPACKAGEVERSION = 6.1.0\n  ASSOCIATEDINSTRUMENTSHORTNAME.1 = MODIS\n  ASSOCIATEDPLATFORMSHORTNAME.1 = AMPM\n  ASSOCIATEDSENSORSHORTNAME.1 = MODIS\n  AUTOMATICQUALITYFLAG.1 = Passed\n  AUTOMATICQUALITYFLAGEXPLANATION.1 = Always Passed.\n  DAYNIGHTFLAG         = Day\n  description          = 2 day flood pixels detected from Terra and Aqua\n  no clouds removed\n  terrain shadow pixels masked\n  HAND pixels masked\n  threshold from table, minimum of 2\nFlag values:\n    255 : Insufficient data\n    0 : No water\n    1 : Water (matches standard reference water)\n    2 : Recurring flood (expected seasonal flood)\n    3 : Flood (unusual)\n\n  DESCRREVISION        = 6.1.4\n  EASTBOUNDINGCOORDINATE = 0.000000\n  EQUATORCROSSINGDATE.1 = 0\n  EQUATORCROSSINGLONGITUDE.1 = 0\n  EQUATORCROSSINGTIME.1 = 0\n  EXCLUSIONGRINGFLAG   = N\n  GRINGPOINTLATITUDE   = 40, 40, 30, 30\n  GRINGPOINTLONGITUDE  = -10, 0, 0, -10\n  GRINGPOINTSEQUENCENO = 1, 2, 3, 4\n  HDFEOSVersion        = HDFEOS_V2.20\n  HORIZONTALTILENUMBER = 17\n  identifier_product_doi = 10.5067/MODIS/MCDWD_L3_NRT.061\n\n  identifier_product_doi_authority = http://dx.doi.org\n\n  INPUTPOINTER         = MCDWD_IHMA.A2023001.h17v05.001.img,MCDWD_IRWMA.A2023001.h17v05.001.img,MCDWD_L3_NRT.A2024305.h17v05.061.2024306060718.hdf,MODWDLGA_NRT.A2024306.0905.h17v05.061.2024306103428.hdf,MODWDLGA_NRT.A2024306.1040.h17v05.061.2024306115011.hdf,MODWDLGA_NRT.A2024306.1045.h17v05.061.2024306114951.hdf,MODWD_ITSM.A2010022.h17v05.001.img,MYDWDLGA_NRT.A2024306.1415.h17v05.061.2024306152549.hdf,MYDWDLGA_NRT.A2024306.1420.h17v05.061.2024306152510.hdf,MYDWD_ITSM.A2010022.h17v05.001.img\n  INSTRUMENTNAME       = Moderate-Resolution Imaging SpectroRadiometer\n  LOCALGRANULEID       = MCDWD_L3_NRT.A2024306.h17v05.061.2024307013418.hdf\n  LOCALVERSIONID       = 6.1.4\n  LONGNAME             = MODIS/Aqua+Terra Flood Map Daily L3 Global 250m LLL Grid NRT\n  NORTHBOUNDINGCOORDINATE = 40.000000\n  ORBITNUMBER.1        = 0\n  PGEVERSION           = 6.1.4\n  PROCESSINGCENTER     = MODAPS\n  PROCESSINGENVIRONMENT = Linux minion20312 5.4.0-1099-fips #109-Ubuntu SMP Tue Apr 30 14:07:22 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux\n  PRODUCTIONDATETIME   = 2024-11-02T01:34:18\n  PRODUCTIONHISTORY    = PGE159N:6.1.4;\n  QAPERCENTCLOUDCOVER  = 0\n  QAPERCENTCLOUDSHADOW = 0\n  QAPERCENTMISSINGDATA = 0\n  QAPERCENTOUTOFBOUNDSDATA = 0\n  RANGEBEGINNINGDATE   = 2024-11-01\n  RANGEBEGINNINGTIME   = 00:00:00\n  RANGEENDINGDATE      = 2024-11-02\n  RANGEENDINGTIME      = 00:00:00\n  REPROCESSINGACTUAL   = Near Real Time\n  REPROCESSINGPLANNED  = further update is anticipated\n  SCIENCEQUALITYFLAG.1 = Not Investigated\n  SCIENCEQUALITYFLAGEXPLANATION.1 = 0\n  SHORTNAME            = MCDWD_L3_NRT\n  SOUTHBOUNDINGCOORDINATE = 30.000000\n  TileID               = 61017005\n  units                = none\n  VERSIONID            = 61\n  VERTICALTILENUMBER   = 05\n  WESTBOUNDINGCOORDINATE = -10.000000\n  AREA_OR_POINT        = Area\n\n\nThe size of the data array band1:\n\nsize(ds[\"band1\"])\n\n(4800, 4800)\n\nConcatenate two geoTIFF files along the cols dimension (columns)\n\nds = TIFFDataset(fnames,aggdim = \"cols\");\n\nThe band1 array is now twice as large:\n\nsize(ds[\"band1\"])\n\n(9600, 4800)\n\nMake a virtual subset based on coordinate values using longitude (x) and latitude (y)\n\nds2 = @select(ds,-1 <= x <= 0.3 && 38.1 <= y <= 39.53);\n\nLoad all the data\n\nband1 = ds2[\"band1\"][:,:];\nlon = ds2[\"lon\"][:,:];\nlat = ds2[\"lat\"][:,:];\n\nExtract the attribute \"production date time\" for the metadata\n\ndatetime = DateTime(ds.attrib[\"PRODUCTIONDATETIME\"])\n\n2024-11-02T01:34:18\n\nMake a plot\n\ntitle = \"surface water \" * Dates.format(datetime,\"yyyy-mm-dd\")\n\nfig = Figure(size=(800,500));\nga = Axis(fig[1, 1]; title = title,\n          xlabel = \"longitude\",\n          ylabel = \"latitude\",\n          aspect = AxisAspect(1/cosd(mean(lat))))\nxlims!(ga,extrema(lon))\nylims!(ga,extrema(lat))\ns = surface!(ga,lon,lat,band1,\n             shading = NoShading,\n             colormap = cgrad(ColorScheme([colorant\"sandybrown\",\n                                           colorant\"lightblue\",\n                                           colorant\"darkred\",\n                                           colorant\"red\"]),\n                              4, categorical = true),\n             colorrange = (-0.5, 3.5))\nColorbar(fig[1,2],s,ticks = 0:3)\nfig\n\n(Image: )\n\nLoad the \"description\" attribute\n\nprintln(ds.attrib[\"description\"])\n\n2 day flood pixels detected from Terra and Aqua\n  no clouds removed\n  terrain shadow pixels masked\n  HAND pixels masked\n  threshold from table, minimum of 2\nFlag values:\n    255 : Insufficient data\n    0 : No water\n    1 : Water (matches standard reference water)\n    2 : Recurring flood (expected seasonal flood)\n    3 : Flood (unusual)\n\n","category":"section"}]
}
